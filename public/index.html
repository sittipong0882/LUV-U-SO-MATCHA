<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUV U SO MATCHA - POS System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyARsVbxthikHcXx8e5MoOW8OM8bmTb4HUY",
            authDomain: "pos-data-luv-u-so-matcha.firebaseapp.com",
            projectId: "pos-data-luv-u-so-matcha",
            storageBucket: "pos-data-luv-u-so-matcha.firebasestorage.app",
            messagingSenderId: "673822905976",
            appId: "1:673822905976:web:b8638c72895e219ebe7f8d",
            measurementId: "G-9BL95VFG8F"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make Firebase functions available globally
        window.db = db;
        window.firestore = { collection, addDoc, getDocs, updateDoc, deleteDoc, doc, onSnapshot };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Kanit', sans-serif; }
        .matcha-gradient { background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%); }
        .matcha-light { background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); }
        
        /* Notification Styles */
        .notification {
            transform: translateX(100%);
            transition: all 0.3s ease-in-out;
        }
        .notification.show {
            transform: translateX(0);
        }
        .notification.hide {
            transform: translateX(100%);
        }
        
        /* Notification animations */
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* Modal animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .modal-backdrop {
            animation: fadeIn 0.2s ease-out;
        }
        .modal-content {
            animation: scaleIn 0.2s ease-out;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 modal-backdrop">
        <div class="bg-white p-8 rounded-2xl shadow-xl w-96 modal-content">
            <div class="text-center mb-8">
                <div class="text-4xl mb-2">üçµ</div>
                <h1 class="text-2xl font-bold text-green-800">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏°‡πà‡∏Ñ‡πâ‡∏≤</h1>
                <p class="text-green-600">LUV U SO MATCHA</p>
            </div>
            
            <div class="space-y-4">
                <input type="text" id="adminUser" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                <input type="password" id="adminPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                
                <div class="flex space-x-3">
                    <button onclick="loginAsAdmin()" class="flex-1 bg-green-700 hover:bg-green-800 text-white py-3 px-4 rounded-lg font-medium transition-colors">
                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                    <button onclick="closeModal('adminLoginModal')" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-lg font-medium transition-colors">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="matcha-gradient text-white p-4 shadow-lg">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">üçµ</span>
                    <h1 class="text-xl font-bold">LUV U SO MATCHA</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="userRole" class="bg-white/20 px-3 py-1 rounded-full text-sm"></span>
                    <!-- Admin Login Button (only show for customers) -->
                    <button id="adminLoginBtn" onclick="showAdminLogin()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors customer-only">
                        üë§ ‡πÅ‡∏°‡πà‡∏Ñ‡πâ‡∏≤
                    </button>
                    <!-- Logout Button (only show for admin) -->
                    <button id="logoutBtn" onclick="logout()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors admin-only hidden">
                        ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white shadow-sm border-b" id="navigationBar">
            <div class="flex space-x-1 p-2">
                <button onclick="showSection('dashboard')" class="nav-btn px-4 py-2 rounded-lg font-medium transition-colors admin-only" data-section="dashboard">
                    üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                </button>
                <button onclick="showSection('sell')" class="nav-btn px-4 py-2 rounded-lg font-medium transition-colors" data-section="sell">
                    üí∞ ‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </button>
                <button onclick="showSection('products')" class="nav-btn px-4 py-2 rounded-lg font-medium transition-colors admin-only" data-section="products">
                    üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </button>

                <button onclick="showSection('reviews')" class="nav-btn px-4 py-2 rounded-lg font-medium transition-colors admin-only" data-section="reviews">
                    üí¨ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡∏ß‡∏¥‡∏ß
                </button>
                <button onclick="showSection('finance')" class="nav-btn px-4 py-2 rounded-lg font-medium transition-colors admin-only" data-section="finance">
                    üí∞ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
                </button>
                <button onclick="showSection('reports')" class="nav-btn px-4 py-2 rounded-lg font-medium transition-colors admin-only" data-section="reports">
                    üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                </button>
            </div>
        </nav>

        <!-- Content Sections -->
        <main class="p-6">
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="section">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                                <p id="todaySales" class="text-2xl font-bold text-green-600">‡∏ø0</p>
                            </div>
                            <div class="text-3xl">üí∞</div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡∏Å‡∏≥‡πÑ‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                                <p id="todayProfit" class="text-2xl font-bold text-blue-600">‡∏ø0</p>
                            </div>
                            <div class="text-3xl">üìà</div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡πÅ‡∏Å‡πâ‡∏ß‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                                <p id="todayCups" class="text-2xl font-bold text-purple-600">0</p>
                            </div>
                            <div class="text-3xl">ü•§</div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
                                <p id="monthSales" class="text-2xl font-bold text-orange-600">‡∏ø0</p>
                            </div>
                            <div class="text-3xl">üíµ</div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <h3 class="text-lg font-semibold mb-4">üìä ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á)</h3>
                        <div style="height: 250px; width: 100%;">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <h3 class="text-lg font-semibold mb-4">üèÜ ‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ TOP 5</h3>
                        <div id="dashboardTopProducts" class="space-y-3">
                            <!-- Top products will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sell Section -->
            <div id="sellSection" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6" id="sellSectionTitle">‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                
                <!-- Customer View - Menu Only -->
                <div id="customerMenuView" class="hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Menu Section -->
                        <div class="lg:col-span-2">
                            <div class="bg-white p-6 rounded-xl shadow-sm border">
                                <h3 class="text-lg font-semibold mb-4 text-center">üçµ ‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h3>
                                <div id="customerProductGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- Customer products will be loaded here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Review Section -->
                        <div class="space-y-6">
                            <!-- Write Review -->
                            <div class="bg-white p-6 rounded-xl shadow-sm border">
                                <h3 class="text-lg font-semibold mb-4 text-center">‚úçÔ∏è ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</h3>
                                <div class="space-y-4">
                                    <input type="text" id="reviewerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏¥‡∏£‡∏ô‡∏≤‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 1)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                    
                                    <!-- Star Rating -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</label>
                                        <div class="flex justify-center space-x-2" id="starRating">
                                            <button onclick="setRating(1)" class="star-btn text-4xl text-gray-300 hover:text-yellow-400 hover:scale-110 transition-all duration-200 focus:outline-none" data-rating="1">‚òÖ</button>
                                            <button onclick="setRating(2)" class="star-btn text-4xl text-gray-300 hover:text-yellow-400 hover:scale-110 transition-all duration-200 focus:outline-none" data-rating="2">‚òÖ</button>
                                            <button onclick="setRating(3)" class="star-btn text-4xl text-gray-300 hover:text-yellow-400 hover:scale-110 transition-all duration-200 focus:outline-none" data-rating="3">‚òÖ</button>
                                            <button onclick="setRating(4)" class="star-btn text-4xl text-gray-300 hover:text-yellow-400 hover:scale-110 transition-all duration-200 focus:outline-none" data-rating="4">‚òÖ</button>
                                            <button onclick="setRating(5)" class="star-btn text-4xl text-gray-300 hover:text-yellow-400 hover:scale-110 transition-all duration-200 focus:outline-none" data-rating="5">‚òÖ</button>
                                        </div>
                                        <p id="ratingText" class="text-center text-sm font-medium text-gray-600 mt-2 min-h-[20px]">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                                    </div>
                                    
                                    <textarea id="reviewText" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 resize-none"></textarea>
                                    
                                    <button onclick="submitReview()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-colors">
                                        ‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Recent Reviews -->
                            <div class="bg-white p-6 rounded-xl shadow-sm border">
                                <h3 class="text-lg font-semibold mb-4 text-center">üí¨ ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                                <div id="recentReviews" class="space-y-3 max-h-96 overflow-y-auto">
                                    <p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin View - Full POS -->
                <div id="adminPOSView" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Product Selection -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <h3 class="text-lg font-semibold mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                        <div id="productGrid" class="grid grid-cols-2 gap-3">
                            <!-- Products will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="space-y-6">
                        <!-- Cart -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border">
                            <h3 class="text-lg font-semibold mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>
                            <div id="cartItems" class="space-y-2 mb-4 max-h-64 overflow-y-auto">
                                <p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
                            </div>
                            
                            <div class="border-t pt-4">
                                <div class="flex justify-between items-center text-lg font-semibold">
                                    <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°:</span>
                                    <span id="totalAmount" class="text-green-600">‡∏ø0</span>
                                </div>
                                <button onclick="processOrder()" class="w-full mt-4 bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-colors">
                                    ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                                </button>
                            </div>
                        </div>
                        
                        <!-- Sales History -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border">
                            <h3 class="text-lg font-semibold mb-4">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                            <div id="recentSales" class="space-y-2 max-h-64 overflow-y-auto">
                                <p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Management Section -->
            <div id="productsSection" class="section hidden admin-only">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                    <button onclick="showAddProductModal()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                    </button>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="productsTable" class="bg-white divide-y divide-gray-200">
                                <!-- Products will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>



            <!-- Reviews Management Section -->
            <div id="reviewsSection" class="section hidden admin-only">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</h2>
                
                <!-- Reviews Summary -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p id="totalReviews" class="text-2xl font-bold text-blue-600">0</p>
                            </div>
                            <div class="text-3xl">üí¨</div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</p>
                                <p id="averageRating" class="text-2xl font-bold text-yellow-600">0.0</p>
                            </div>
                            <div class="text-3xl">‚≠ê</div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                                <p id="todayReviews" class="text-2xl font-bold text-green-600">0</p>
                            </div>
                            <div class="text-3xl">üìù</div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡∏£‡∏≠‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</p>
                                <p id="pendingReplies" class="text-2xl font-bold text-orange-600">0</p>
                            </div>
                            <div class="text-3xl">‚è≥</div>
                        </div>
                    </div>
                </div>
                
                <!-- Reviews List -->
                <div class="bg-white rounded-xl shadow-sm border">
                    <div class="p-6 border-b">
                        <h3 class="text-lg font-semibold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    </div>
                    <div id="adminReviewsList" class="p-6 space-y-4 max-h-96 overflow-y-auto">
                        <!-- Reviews will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Finance Management Section -->
            <div id="financeSection" class="section hidden admin-only">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>
                    <button onclick="showAddFinanceModal()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    </button>
                </div>
                
                <!-- Finance Summary -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p id="totalIncome" class="text-2xl font-bold text-green-600">‡∏ø0</p>
                            </div>
                            <div class="text-3xl">üìà</div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p id="totalExpense" class="text-2xl font-bold text-red-600">‡∏ø0</p>
                            </div>
                            <div class="text-3xl">üìâ</div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</p>
                                <p id="netBalance" class="text-2xl font-bold text-blue-600">‡∏ø0</p>
                            </div>
                            <div class="text-3xl">üí∞</div>
                        </div>
                    </div>
                </div>
                
                <!-- Charts Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <h3 class="text-lg font-semibold mb-4">üìä ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                        <div style="height: 300px; width: 100%;">
                            <canvas id="financeChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <h3 class="text-lg font-semibold mb-4">ü•ß ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
                        <div style="height: 300px; width: 100%;">
                            <canvas id="expenseChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Finance Records Table -->
                <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                    <div class="p-6 border-b">
                        <h3 class="text-lg font-semibold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="financeTable" class="bg-white divide-y divide-gray-200">
                                <!-- Finance records will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reportsSection" class="section hidden admin-only">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•</h2>
                
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p id="totalRevenue" class="text-2xl font-bold text-green-600">‡∏ø0</p>
                            </div>
                            <div class="text-3xl">üí∞</div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p id="netProfit" class="text-2xl font-bold text-blue-600">‡∏ø0</p>
                            </div>
                            <div class="text-3xl">üìà</div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡πÅ‡∏Å‡πâ‡∏ß‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p id="totalCups" class="text-2xl font-bold text-purple-600">0</p>
                            </div>
                            <div class="text-3xl">ü•§</div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£</p>
                                <p id="profitMargin" class="text-2xl font-bold text-orange-600">0%</p>
                            </div>
                            <div class="text-3xl">üìä</div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-sm border">
                    <h3 class="text-lg font-semibold mb-4">üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    <div id="productReport" class="space-y-3">
                        <!-- Product report will be loaded here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-3 max-w-sm">
        <!-- Notifications will be added here -->
    </div>

    <!-- Modals -->
    <!-- Add Product Modal -->
    <div id="addProductModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 modal-backdrop">
        <div class="bg-white p-6 rounded-xl shadow-xl w-96 max-h-[90vh] overflow-y-auto modal-content">
            <h3 class="text-lg font-semibold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
            <div class="space-y-4">
                <input type="text" id="productName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                <input type="number" id="productPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                <input type="number" id="productCost" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                <textarea id="productDescription" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 resize-none"></textarea>
                
                <!-- Image Upload Section -->
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                    <input type="file" id="productImage" accept="image/*" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    <div id="imagePreview" class="hidden mt-2">
                        <img id="previewImg" src="" alt="Preview" class="w-32 h-32 object-cover rounded-lg border mx-auto">
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="addProduct()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors">
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°
                    </button>
                    <button onclick="closeModal('addProductModal')" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg transition-colors">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reply to Review Modal -->
    <div id="replyReviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 modal-backdrop">
        <div class="bg-white p-6 rounded-xl shadow-xl w-96 max-h-[90vh] overflow-y-auto modal-content">
            <h3 class="text-lg font-semibold mb-4">‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</h3>
            
            <!-- Original Review Display -->
            <div id="originalReview" class="bg-gray-50 p-4 rounded-lg mb-4">
                <!-- Original review content will be loaded here -->
            </div>
            
            <div class="space-y-4">
                <input type="hidden" id="replyReviewId">
                <textarea id="adminReplyText" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 resize-none"></textarea>
                
                <div class="flex space-x-3">
                    <button onclick="submitReply()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors">
                        ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                    <button onclick="closeModal('replyReviewModal')" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg transition-colors">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div id="editProductModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 modal-backdrop">
        <div class="bg-white p-6 rounded-xl shadow-xl w-96 max-h-[90vh] overflow-y-auto modal-content">
            <h3 class="text-lg font-semibold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
            <div class="space-y-4">
                <input type="hidden" id="editProductId">
                <input type="text" id="editProductName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                <input type="number" id="editProductPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                <input type="number" id="editProductCost" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                <textarea id="editProductDescription" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 resize-none"></textarea>
                
                <!-- Image Upload Section -->
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                    <input type="file" id="editProductImage" accept="image/*" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    <div id="editImagePreview" class="hidden mt-2">
                        <img id="editPreviewImg" src="" alt="Preview" class="w-32 h-32 object-cover rounded-lg border mx-auto">
                    </div>
                    <div id="currentImagePreview" class="mt-2">
                        <img id="currentImg" src="" alt="Current" class="w-32 h-32 object-cover rounded-lg border mx-auto">
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="updateProduct()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition-colors">
                        ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
                    </button>
                    <button onclick="closeModal('editProductModal')" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg transition-colors">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Finance Modal -->
    <div id="addFinanceModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 modal-backdrop">
        <div class="bg-white p-6 rounded-xl shadow-xl w-96 max-h-[90vh] overflow-y-auto modal-content">
            <h3 class="text-lg font-semibold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                    <input type="date" id="financeDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                    <select id="financeType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                        <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
                        <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                    <input type="text" id="financeItem" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á, ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà, ‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                    <input type="number" id="financeAmount" placeholder="0" min="0" step="0.01" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                    <textarea id="financeNote" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..." rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 resize-none"></textarea>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="addFinanceRecord()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button onclick="closeModal('addFinanceModal')" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg transition-colors">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Finance Modal -->
    <div id="editFinanceModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 modal-backdrop">
        <div class="bg-white p-6 rounded-xl shadow-xl w-96 max-h-[90vh] overflow-y-auto modal-content">
            <h3 class="text-lg font-semibold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
            <div class="space-y-4">
                <input type="hidden" id="editFinanceId">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                    <input type="date" id="editFinanceDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                    <select id="editFinanceType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                        <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
                        <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                    <input type="text" id="editFinanceItem" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á, ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà, ‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                    <input type="number" id="editFinanceAmount" placeholder="0" min="0" step="0.01" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                    <textarea id="editFinanceNote" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..." rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 resize-none"></textarea>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="updateFinanceRecord()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition-colors">
                        ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
                    </button>
                    <button onclick="closeModal('editFinanceModal')" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg transition-colors">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>



    <script>
        // Global variables
        let currentUser = null;
        let isAdmin = false;
        let cart = [];
        let products = [];

        let sales = [];
        let reviews = [];
        let financeRecords = [];
        let salesChart = null;
        let financeChart = null;
        let expenseChart = null;
        let currentRating = 0;
        let notificationId = 0;

        // Notification System
        function showNotification(message, type = 'success', duration = 4000) {
            const container = document.getElementById('notificationContainer');
            const id = ++notificationId;
            
            // Notification types and their styles
            const types = {
                success: {
                    icon: '‚úÖ',
                    bgColor: 'bg-green-500',
                    textColor: 'text-white',
                    borderColor: 'border-green-600'
                },
                error: {
                    icon: '‚ùå',
                    bgColor: 'bg-red-500',
                    textColor: 'text-white',
                    borderColor: 'border-red-600'
                },
                warning: {
                    icon: '‚ö†Ô∏è',
                    bgColor: 'bg-yellow-500',
                    textColor: 'text-white',
                    borderColor: 'border-yellow-600'
                },
                info: {
                    icon: '‚ÑπÔ∏è',
                    bgColor: 'bg-blue-500',
                    textColor: 'text-white',
                    borderColor: 'border-blue-600'
                }
            };
            
            const config = types[type] || types.success;
            
            const notification = document.createElement('div');
            notification.id = `notification-${id}`;
            notification.className = `notification ${config.bgColor} ${config.textColor} p-4 rounded-lg shadow-lg border-l-4 ${config.borderColor} max-w-sm transform transition-all duration-300 ease-in-out`;
            
            notification.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0 text-xl">${config.icon}</div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium leading-5">${message}</p>
                    </div>
                    <button onclick="hideNotification(${id})" class="flex-shrink-0 ml-2 text-white hover:text-gray-200 focus:outline-none">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Trigger animation
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Auto hide after duration
            if (duration > 0) {
                setTimeout(() => {
                    hideNotification(id);
                }, duration);
            }
            
            return id;
        }

        function hideNotification(id) {
            const notification = document.getElementById(`notification-${id}`);
            if (notification) {
                notification.classList.add('hide');
                notification.classList.remove('show');
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }
        }

        function showConfirmDialog(message, onConfirm, onCancel = null) {
            const id = ++notificationId;
            const container = document.getElementById('notificationContainer');
            
            const dialog = document.createElement('div');
            dialog.id = `confirm-dialog-${id}`;
            dialog.className = 'notification bg-white border border-gray-300 p-4 rounded-lg shadow-xl max-w-sm transform transition-all duration-300 ease-in-out';
            
            dialog.innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 text-xl">‚ùì</div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-800 leading-5">${message}</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="confirmAction(${id}, true)" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-3 rounded text-sm font-medium transition-colors">
                            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                        </button>
                        <button onclick="confirmAction(${id}, false)" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm font-medium transition-colors">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                    </div>
                </div>
            `;
            
            container.appendChild(dialog);
            
            // Store callbacks
            window[`confirmCallback_${id}`] = onConfirm;
            window[`cancelCallback_${id}`] = onCancel;
            
            // Trigger animation
            setTimeout(() => {
                dialog.classList.add('show');
            }, 10);
            
            return id;
        }

        function confirmAction(id, confirmed) {
            const dialog = document.getElementById(`confirm-dialog-${id}`);
            if (dialog) {
                dialog.classList.add('hide');
                dialog.classList.remove('show');
                
                setTimeout(() => {
                    if (dialog.parentNode) {
                        dialog.parentNode.removeChild(dialog);
                    }
                }, 300);
            }
            
            if (confirmed && window[`confirmCallback_${id}`]) {
                window[`confirmCallback_${id}`]();
            } else if (!confirmed && window[`cancelCallback_${id}`]) {
                window[`cancelCallback_${id}`]();
            }
            
            // Clean up callbacks
            delete window[`confirmCallback_${id}`];
            delete window[`cancelCallback_${id}`];
        }

        // Firebase helper functions
        async function initializeFirebaseData() {
            try {
                // Load products from Firebase
                await loadProductsFromFirebase();
                
                // Load sales from Firebase
                await loadSalesFromFirebase();
                
                // Load reviews from Firebase
                await loadReviewsFromFirebase();
                
                // Load finance records from Firebase
                await loadFinanceRecordsFromFirebase();
                
                // If no data exists, create initial data
                if (products.length === 0) {
                    await createInitialProducts();
                }
                

                
                console.log('Firebase data initialized successfully');
            } catch (error) {
                console.error('Error initializing Firebase data:', error);
                // Fallback to local data if Firebase fails
                initializeLocalData();
            }
        }

        async function createInitialProducts() {
            const initialProducts = [
                { name: '‡∏°‡∏±‡∏ó‡∏â‡∏∞‡∏•‡∏≤‡πÄ‡∏ï‡πâ', price: 65, cost: 35, emoji: 'üçµ', active: true, sold: 0 },
                { name: '‡∏°‡∏±‡∏ó‡∏â‡∏∞‡∏ü‡∏£‡∏≤‡πÄ‡∏õ‡πâ', price: 75, cost: 40, emoji: 'ü•§', active: true, sold: 0 },
                { name: '‡∏°‡∏±‡∏ó‡∏â‡∏∞‡πÄ‡∏Ñ‡πâ‡∏Å', price: 85, cost: 45, emoji: 'üç∞', active: true, sold: 0 },
                { name: '‡∏°‡∏±‡∏ó‡∏â‡∏∞‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°', price: 55, cost: 30, emoji: 'üç¶', active: true, sold: 0 }
            ];
            
            for (const product of initialProducts) {
                await saveProductToFirebase(product);
            }
        }



        function initializeLocalData() {
            products = [
                { id: 1, name: '‡∏°‡∏±‡∏ó‡∏â‡∏∞‡∏•‡∏≤‡πÄ‡∏ï‡πâ', price: 65, cost: 35, emoji: 'üçµ', active: true, sold: 0 },
                { id: 2, name: '‡∏°‡∏±‡∏ó‡∏â‡∏∞‡∏ü‡∏£‡∏≤‡πÄ‡∏õ‡πâ', price: 75, cost: 40, emoji: 'ü•§', active: true, sold: 0 },
                { id: 3, name: '‡∏°‡∏±‡∏ó‡∏â‡∏∞‡πÄ‡∏Ñ‡πâ‡∏Å', price: 85, cost: 45, emoji: 'üç∞', active: true, sold: 0 },
                { id: 4, name: '‡∏°‡∏±‡∏ó‡∏â‡∏∞‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°', price: 55, cost: 30, emoji: 'üç¶', active: true, sold: 0 }
            ];

        }

        // Firebase CRUD operations for Products
        async function loadProductsFromFirebase() {
            try {
                const querySnapshot = await window.firestore.getDocs(window.firestore.collection(window.db, 'products'));
                products = [];
                querySnapshot.forEach((doc) => {
                    products.push({ id: doc.id, ...doc.data() });
                });
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        async function saveProductToFirebase(product) {
            try {
                const docRef = await window.firestore.addDoc(window.firestore.collection(window.db, 'products'), product);
                product.id = docRef.id;
                products.push(product);
                return docRef.id;
            } catch (error) {
                console.error('Error saving product:', error);
                throw error;
            }
        }

        async function updateProductInFirebase(productId, updates) {
            try {
                const productRef = window.firestore.doc(window.db, 'products', productId);
                await window.firestore.updateDoc(productRef, updates);
                
                // Update local array
                const productIndex = products.findIndex(p => p.id === productId);
                if (productIndex !== -1) {
                    products[productIndex] = { ...products[productIndex], ...updates };
                }
            } catch (error) {
                console.error('Error updating product:', error);
                throw error;
            }
        }

        async function deleteProductFromFirebase(productId) {
            try {
                await window.firestore.deleteDoc(window.firestore.doc(window.db, 'products', productId));
                products = products.filter(p => p.id !== productId);
            } catch (error) {
                console.error('Error deleting product:', error);
                throw error;
            }
        }



        // Firebase CRUD operations for Sales
        async function loadSalesFromFirebase() {
            try {
                const querySnapshot = await window.firestore.getDocs(window.firestore.collection(window.db, 'sales'));
                sales = [];
                querySnapshot.forEach((doc) => {
                    sales.push({ id: doc.id, ...doc.data() });
                });
            } catch (error) {
                console.error('Error loading sales:', error);
            }
        }

        async function saveSaleToFirebase(sale) {
            try {
                const docRef = await window.firestore.addDoc(window.firestore.collection(window.db, 'sales'), sale);
                sale.id = docRef.id;
                sales.push(sale);
                return docRef.id;
            } catch (error) {
                console.error('Error saving sale:', error);
                throw error;
            }
        }

        // Firebase CRUD operations for Reviews
        async function loadReviewsFromFirebase() {
            try {
                const querySnapshot = await window.firestore.getDocs(window.firestore.collection(window.db, 'reviews'));
                reviews = [];
                querySnapshot.forEach((doc) => {
                    reviews.push({ id: doc.id, ...doc.data() });
                });
            } catch (error) {
                console.error('Error loading reviews:', error);
            }
        }

        async function saveReviewToFirebase(review) {
            try {
                const docRef = await window.firestore.addDoc(window.firestore.collection(window.db, 'reviews'), review);
                review.id = docRef.id;
                reviews.push(review);
                return docRef.id;
            } catch (error) {
                console.error('Error saving review:', error);
                throw error;
            }
        }

        async function updateReviewInFirebase(reviewId, updates) {
            try {
                const reviewRef = window.firestore.doc(window.db, 'reviews', reviewId);
                await window.firestore.updateDoc(reviewRef, updates);
                
                // Update local array
                const reviewIndex = reviews.findIndex(r => r.id === reviewId);
                if (reviewIndex !== -1) {
                    reviews[reviewIndex] = { ...reviews[reviewIndex], ...updates };
                }
            } catch (error) {
                console.error('Error updating review:', error);
                throw error;
            }
        }

        // Firebase CRUD operations for Finance Records
        async function loadFinanceRecordsFromFirebase() {
            try {
                const querySnapshot = await window.firestore.getDocs(window.firestore.collection(window.db, 'finance'));
                financeRecords = [];
                querySnapshot.forEach((doc) => {
                    financeRecords.push({ id: doc.id, ...doc.data() });
                });
            } catch (error) {
                console.error('Error loading finance records:', error);
            }
        }

        async function saveFinanceRecordToFirebase(record) {
            try {
                const docRef = await window.firestore.addDoc(window.firestore.collection(window.db, 'finance'), record);
                record.id = docRef.id;
                financeRecords.push(record);
                return docRef.id;
            } catch (error) {
                console.error('Error saving finance record:', error);
                throw error;
            }
        }

        async function updateFinanceRecordInFirebase(recordId, updates) {
            try {
                const recordRef = window.firestore.doc(window.db, 'finance', recordId);
                await window.firestore.updateDoc(recordRef, updates);
                
                // Update local array
                const recordIndex = financeRecords.findIndex(r => r.id === recordId);
                if (recordIndex !== -1) {
                    financeRecords[recordIndex] = { ...financeRecords[recordIndex], ...updates };
                }
            } catch (error) {
                console.error('Error updating finance record:', error);
                throw error;
            }
        }

        async function deleteFinanceRecordFromFirebase(recordId) {
            try {
                await window.firestore.deleteDoc(window.firestore.doc(window.db, 'finance', recordId));
                financeRecords = financeRecords.filter(r => r.id !== recordId);
            } catch (error) {
                console.error('Error deleting finance record:', error);
                throw error;
            }
        }

        // Login functions
        function showAdminLogin() {
            document.getElementById('adminLoginModal').classList.remove('hidden');
            document.getElementById('adminLoginModal').classList.add('flex');
        }

        function loginAsAdmin() {
            const username = document.getElementById('adminUser').value;
            const password = document.getElementById('adminPass').value;
            
            if (username === 'Admin' && password === '1234') {
                currentUser = '‡πÅ‡∏°‡πà‡∏Ñ‡πâ‡∏≤';
                isAdmin = true;
                closeModal('adminLoginModal');
                document.getElementById('adminUser').value = '';
                document.getElementById('adminPass').value = '';
                showNotification('üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏Ñ‡πâ‡∏≤! ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                showMainApp();
            } else {
                showNotification('üîê ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            }
        }

        function logout() {
            currentUser = '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤';
            isAdmin = false;
            cart = [];
            showMainApp(); // Go back to customer view
        }

        async function showMainApp() {
            showLoading();
            
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userRole').textContent = currentUser;
            
            // Show/hide admin elements
            const adminElements = document.querySelectorAll('.admin-only');
            const customerElements = document.querySelectorAll('.customer-only');
            
            adminElements.forEach(el => {
                if (isAdmin) {
                    el.classList.remove('hidden');
                } else {
                    el.classList.add('hidden');
                }
            });
            
            customerElements.forEach(el => {
                if (isAdmin) {
                    el.classList.add('hidden');
                } else {
                    el.classList.remove('hidden');
                }
            });
            
            // Hide navigation bar for customers
            const navigationBar = document.getElementById('navigationBar');
            if (isAdmin) {
                navigationBar.classList.remove('hidden');
            } else {
                navigationBar.classList.add('hidden');
            }
            
            try {
                // Initialize Firebase data
                await initializeFirebaseData();
                
                // Show appropriate section based on user role
                if (isAdmin) {
                    showSection('dashboard');
                } else {
                    showSection('sell'); // Customer goes directly to menu
                    document.getElementById('sellSectionTitle').textContent = 'üçµ ‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤';
                }
                
                loadProducts();
                updateDashboard();
                if (isAdmin) {
                    loadRecentSales();
                }
                
                // Welcome notification
                if (isAdmin) {
                    showNotification('üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß', 'success');
                } else {
                    showNotification('üçµ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà LUV U SO MATCHA! ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢', 'success');
                }
            } catch (error) {
                console.error('Error initializing app:', error);
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö', 'error');
            } finally {
                hideLoading();
            }
        }

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionName + 'Section').classList.remove('hidden');
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-green-500', 'text-white');
                btn.classList.add('text-gray-600', 'hover:bg-gray-100');
            });
            
            const activeBtn = document.querySelector(`[data-section="${sectionName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('bg-green-500', 'text-white');
                activeBtn.classList.remove('text-gray-600', 'hover:bg-gray-100');
            }
            
            // Load section-specific data
            if (sectionName === 'products') {
                loadProductsTable();
            } else if (sectionName === 'reviews') {
                loadAdminReviews();
            } else if (sectionName === 'finance') {
                loadFinanceSection();
            } else if (sectionName === 'reports') {
                loadReports();
            } else if (sectionName === 'dashboard') {
                updateDashboard();
                createSalesChart();
            }
        }

        // Product functions
        function loadProducts() {
            if (isAdmin) {
                loadAdminProducts();
                document.getElementById('adminPOSView').classList.remove('hidden');
                document.getElementById('customerMenuView').classList.add('hidden');
            } else {
                loadCustomerMenu();
                loadRecentReviews();
                document.getElementById('adminPOSView').classList.add('hidden');
                document.getElementById('customerMenuView').classList.remove('hidden');
            }
        }

        function loadAdminProducts() {
            const productGrid = document.getElementById('productGrid');
            productGrid.innerHTML = '';
            
            products.filter(p => p.active).forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'bg-gray-50 p-4 rounded-lg border hover:shadow-md transition-shadow cursor-pointer';
                productCard.onclick = () => addToCart(product);
                
                productCard.innerHTML = `
                    <div class="text-center">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" class="w-16 h-16 object-cover rounded-lg mb-2 mx-auto">` :
                            `<div class="text-3xl mb-2">${product.emoji}</div>`
                        }
                        <h4 class="font-medium text-sm">${product.name}</h4>
                        <p class="text-green-600 font-semibold">‡∏ø${product.price}</p>
                    </div>
                `;
                
                productGrid.appendChild(productCard);
            });
        }

        function loadCustomerMenu() {
            const customerGrid = document.getElementById('customerProductGrid');
            customerGrid.innerHTML = '';
            
            products.filter(p => p.active).forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'bg-white p-6 rounded-xl shadow-sm border hover:shadow-md transition-shadow';
                
                productCard.innerHTML = `
                    <div class="text-center">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" class="w-32 h-32 object-cover rounded-lg mb-4 mx-auto">` :
                            `<div class="text-4xl mb-4">${product.emoji}</div>`
                        }
                        <h4 class="font-semibold text-lg mb-2">${product.name}</h4>
                        <p class="text-green-600 font-bold text-xl">‡∏ø${product.price}</p>
                        <div class="mt-4 text-sm text-gray-600">
                            <p>${product.description || '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏°‡∏±‡∏ó‡∏â‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°'}</p>
                        </div>
                    </div>
                `;
                
                customerGrid.appendChild(productCard);
            });
        }

        function addToCart(product) {
            showCustomizationModal(product);
        }

        function showCustomizationModal(product) {
            // Create modal HTML
            const modalHTML = `
                <div id="customizationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white p-6 rounded-xl shadow-xl w-96 max-h-[90vh] overflow-y-auto">
                        <h3 class="text-lg font-semibold mb-4 text-center">‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</h3>
                        
                        <!-- Product Info -->
                        <div class="text-center mb-6">
                            ${product.image ? 
                                `<img src="${product.image}" alt="${product.name}" class="w-20 h-20 object-cover rounded-lg mx-auto mb-2">` :
                                `<div class="text-3xl mb-2">${product.emoji}</div>`
                            }
                            <h4 class="font-semibold text-lg">${product.name}</h4>
                            <p class="text-green-600 font-bold">‡∏ø${product.price}</p>
                        </div>
                        
                        <!-- Sweetness Level -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-3">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô</label>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="selectSweetness(0)" class="sweetness-btn p-3 border-2 border-gray-300 rounded-lg hover:border-green-500 transition-colors" data-sweetness="0">
                                    <div class="text-center">
                                        <div class="text-lg mb-1">üö´</div>
                                        <div class="text-sm font-medium">0%</div>
                                        <div class="text-xs text-gray-600">‡πÑ‡∏°‡πà‡∏´‡∏ß‡∏≤‡∏ô</div>
                                    </div>
                                </button>
                                <button onclick="selectSweetness(25)" class="sweetness-btn p-3 border-2 border-gray-300 rounded-lg hover:border-green-500 transition-colors" data-sweetness="25">
                                    <div class="text-center">
                                        <div class="text-lg mb-1">üü°</div>
                                        <div class="text-sm font-medium">25%</div>
                                        <div class="text-xs text-gray-600">‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏°‡∏≤‡∏Å</div>
                                    </div>
                                </button>
                                <button onclick="selectSweetness(50)" class="sweetness-btn p-3 border-2 border-gray-300 rounded-lg hover:border-green-500 transition-colors" data-sweetness="50">
                                    <div class="text-center">
                                        <div class="text-lg mb-1">üü†</div>
                                        <div class="text-sm font-medium">50%</div>
                                        <div class="text-xs text-gray-600">‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢</div>
                                    </div>
                                </button>
                                <button onclick="selectSweetness(100)" class="sweetness-btn p-3 border-2 border-gray-300 rounded-lg hover:border-green-500 transition-colors" data-sweetness="100">
                                    <div class="text-center">
                                        <div class="text-lg mb-1">üî¥</div>
                                        <div class="text-sm font-medium">100%</div>
                                        <div class="text-xs text-gray-600">‡∏´‡∏ß‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥</div>
                                    </div>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Ice Options -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-3">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á</label>
                            <div class="grid grid-cols-1 gap-2">
                                <button onclick="selectIce('separate')" class="ice-btn p-3 border-2 border-gray-300 rounded-lg hover:border-green-500 transition-colors" data-ice="separate">
                                    <div class="flex items-center space-x-3">
                                        <div class="text-2xl">üßä</div>
                                        <div class="text-left">
                                            <div class="font-medium">‡πÅ‡∏¢‡∏Å‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á</div>
                                            <div class="text-sm text-gray-600">‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏¢‡∏Å‡∏ñ‡πâ‡∏ß‡∏¢</div>
                                        </div>
                                    </div>
                                </button>
                                <button onclick="selectIce('mixed')" class="ice-btn p-3 border-2 border-gray-300 rounded-lg hover:border-green-500 transition-colors" data-ice="mixed">
                                    <div class="flex items-center space-x-3">
                                        <div class="text-2xl">ü•§</div>
                                        <div class="text-left">
                                            <div class="font-medium">‡πÉ‡∏™‡πà‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡πÄ‡∏•‡∏¢</div>
                                            <div class="text-sm text-gray-600">‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡πÉ‡∏™‡πà‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</div>
                                        </div>
                                    </div>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Quantity -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-3">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
                            <div class="flex items-center justify-center space-x-4">
                                <button onclick="changeCustomQuantity(-1)" class="w-10 h-10 bg-red-500 text-white rounded-full hover:bg-red-600 flex items-center justify-center font-bold">-</button>
                                <span id="customQuantity" class="text-xl font-bold min-w-[3rem] text-center">1</span>
                                <button onclick="changeCustomQuantity(1)" class="w-10 h-10 bg-green-500 text-white rounded-full hover:bg-green-600 flex items-center justify-center font-bold">+</button>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex space-x-3">
                            <button onclick="confirmAddToCart()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-colors">
                                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                            </button>
                            <button onclick="closeCustomizationModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-lg font-medium transition-colors">
                                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('customizationModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Store current product
            window.currentCustomProduct = product;
            window.selectedSweetness = 50; // Default sweetness
            window.selectedIce = 'mixed'; // Default ice option
            window.customQuantity = 1;
            
            // Set default selections
            selectSweetness(50);
            selectIce('mixed');
        }

        function selectSweetness(level) {
            window.selectedSweetness = level;
            
            // Update button styles
            document.querySelectorAll('.sweetness-btn').forEach(btn => {
                btn.classList.remove('border-green-500', 'bg-green-50');
                btn.classList.add('border-gray-300');
            });
            
            const selectedBtn = document.querySelector(`[data-sweetness="${level}"]`);
            if (selectedBtn) {
                selectedBtn.classList.remove('border-gray-300');
                selectedBtn.classList.add('border-green-500', 'bg-green-50');
            }
        }

        function selectIce(option) {
            window.selectedIce = option;
            
            // Update button styles
            document.querySelectorAll('.ice-btn').forEach(btn => {
                btn.classList.remove('border-green-500', 'bg-green-50');
                btn.classList.add('border-gray-300');
            });
            
            const selectedBtn = document.querySelector(`[data-ice="${option}"]`);
            if (selectedBtn) {
                selectedBtn.classList.remove('border-gray-300');
                selectedBtn.classList.add('border-green-500', 'bg-green-50');
            }
        }

        function changeCustomQuantity(change) {
            window.customQuantity = Math.max(1, window.customQuantity + change);
            document.getElementById('customQuantity').textContent = window.customQuantity;
        }

        function confirmAddToCart() {
            const product = window.currentCustomProduct;
            const sweetness = window.selectedSweetness;
            const ice = window.selectedIce;
            const quantity = window.customQuantity;
            
            // Create unique item key for cart
            const itemKey = `${product.id}_${sweetness}_${ice}`;
            
            // Check if same customization exists
            const existingItem = cart.find(item => item.itemKey === itemKey);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                const customizedProduct = {
                    ...product,
                    itemKey: itemKey,
                    sweetness: sweetness,
                    ice: ice,
                    quantity: quantity,
                    customization: {
                        sweetness: sweetness,
                        ice: ice
                    }
                };
                cart.push(customizedProduct);
            }
            
            updateCart();
            closeCustomizationModal();
        }

        function closeCustomizationModal() {
            const modal = document.getElementById('customizationModal');
            if (modal) {
                modal.remove();
            }
        }

        function updateCart() {
            const cartItems = document.getElementById('cartItems');
            const totalAmount = document.getElementById('totalAmount');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>';
                totalAmount.textContent = '‡∏ø0';
                return;
            }
            
            cartItems.innerHTML = '';
            let total = 0;
            
            cart.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                // Format customization display
                const sweetnessText = item.sweetness !== undefined ? `${item.sweetness}%` : '';
                const iceText = item.ice === 'separate' ? '‡πÅ‡∏¢‡∏Å‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á' : item.ice === 'mixed' ? '‡πÉ‡∏™‡πà‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á' : '';
                const customizationText = sweetnessText || iceText ? `(${sweetnessText}${sweetnessText && iceText ? ', ' : ''}${iceText})` : '';
                
                const cartItem = document.createElement('div');
                cartItem.className = 'flex justify-between items-center p-3 bg-gray-50 rounded-lg';
                cartItem.innerHTML = `
                    <div class="flex items-center space-x-3 flex-1">
                        <span class="text-xl">${item.emoji}</span>
                        <div class="flex-1">
                            <p class="font-medium text-sm">${item.name}</p>
                            ${customizationText ? `<p class="text-blue-600 text-xs">${customizationText}</p>` : ''}
                            <p class="text-gray-600 text-xs">‡∏ø${item.price} x ${item.quantity} = ‡∏ø${itemTotal}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="changeCartQuantity(${index}, -1)" class="w-8 h-8 bg-red-500 text-white rounded-full text-sm hover:bg-red-600 flex items-center justify-center font-bold">-</button>
                        <span class="text-sm font-medium min-w-[2rem] text-center">${item.quantity}</span>
                        <button onclick="changeCartQuantity(${index}, 1)" class="w-8 h-8 bg-green-500 text-white rounded-full text-sm hover:bg-green-600 flex items-center justify-center font-bold">+</button>
                    </div>
                `;
                
                cartItems.appendChild(cartItem);
            });
            
            totalAmount.textContent = `‡∏ø${total}`;
        }

        function changeCartQuantity(itemIndex, change) {
            if (itemIndex >= 0 && itemIndex < cart.length) {
                cart[itemIndex].quantity += change;
                if (cart[itemIndex].quantity <= 0) {
                    cart.splice(itemIndex, 1);
                }
                updateCart();
            }
        }

        async function processOrder() {
            if (cart.length === 0) {
                showNotification('üõí ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô', 'warning');
                return;
            }
            
            try {
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                const order = {
                    items: [...cart],
                    total: total,
                    date: new Date().toISOString().split('T')[0],
                    time: new Date().toLocaleTimeString('th-TH'),
                    timestamp: new Date().toISOString()
                };
                
                // Save order to Firebase
                await saveSaleToFirebase(order);
                
                // Update product sold count in Firebase
                for (const cartItem of cart) {
                    const product = products.find(p => p.id === cartItem.id);
                    if (product) {
                        const newSoldCount = product.sold + cartItem.quantity;
                        await updateProductInFirebase(product.id, { sold: newSoldCount });
                    }
                }
                
                cart = [];
                updateCart();
                updateDashboard();
                loadRecentSales();
                
                showNotification(`üí∞ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° ‡∏ø${total.toLocaleString()}`, 'success');
            } catch (error) {
                console.error('Error processing order:', error);
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            }
        }

        // Product management
        function loadProductsTable() {
            const tbody = document.getElementById('productsTable');
            tbody.innerHTML = '';
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            ${product.image ? 
                                `<img src="${product.image}" alt="${product.name}" class="w-12 h-12 object-cover rounded-lg mr-3">` :
                                `<span class="text-2xl mr-3">${product.emoji}</span>`
                            }
                            <span class="font-medium">${product.name}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900 max-w-xs">
                        <p class="truncate">${product.description || '-'}</p>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold text-green-600">‡∏ø${product.price}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold text-red-600">‡∏ø${product.cost || 0}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${product.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${product.active ? '‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏≤‡∏¢' : '‡∏õ‡∏¥‡∏î‡∏Ç‡∏≤‡∏¢'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                        <button onclick="showEditProductModal('${product.id}')" class="text-blue-600 hover:text-blue-900">
                            ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                        <button onclick="toggleProductStatus('${product.id}')" class="text-green-600 hover:text-green-900">
                            ${product.active ? '‡∏õ‡∏¥‡∏î‡∏Ç‡∏≤‡∏¢' : '‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏≤‡∏¢'}
                        </button>
                        <button onclick="deleteProduct('${product.id}')" class="text-red-600 hover:text-red-900">
                            ‡∏•‡∏ö
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function showAddProductModal() {
            document.getElementById('addProductModal').classList.remove('hidden');
            document.getElementById('addProductModal').classList.add('flex');
            
            // Add image preview functionality
            const imageInput = document.getElementById('productImage');
            const imagePreview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');
            
            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImg.src = e.target.result;
                        imagePreview.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    imagePreview.classList.add('hidden');
                }
            });
        }

        async function addProduct() {
            const name = document.getElementById('productName').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const cost = parseFloat(document.getElementById('productCost').value);
            const description = document.getElementById('productDescription').value;
            const imageFile = document.getElementById('productImage').files[0];
            
            if (!name || !price || !cost) {
                showNotification('üìù ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô (‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢, ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô)', 'warning');
                return;
            }
            
            if (cost >= price) {
                showNotification('üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Å‡∏≥‡πÑ‡∏£', 'warning');
                return;
            }
            
            try {
                const newProduct = {
                    name: name,
                    price: price,
                    cost: cost,
                    emoji: 'üçµ', // Default emoji
                    description: description,
                    active: true,
                    sold: 0
                };
                
                // Handle image upload
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        newProduct.image = e.target.result;
                        await saveProductToFirebase(newProduct);
                        loadProducts();
                        loadProductsTable();
                        closeModal('addProductModal');
                        clearProductForm();
                        showNotification('üéâ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    await saveProductToFirebase(newProduct);
                    loadProducts();
                    loadProductsTable();
                    closeModal('addProductModal');
                    clearProductForm();
                    showNotification('üéâ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            } catch (error) {
                console.error('Error adding product:', error);
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            }
        }

        function clearProductForm() {
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productCost').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productImage').value = '';
            document.getElementById('imagePreview').classList.add('hidden');
        }

        async function toggleProductStatus(productId) {
            try {
                const product = products.find(p => p.id === productId);
                if (product) {
                    const newStatus = !product.active;
                    await updateProductInFirebase(productId, { active: newStatus });
                    loadProducts();
                    loadProductsTable();
                }
            } catch (error) {
                console.error('Error toggling product status:', error);
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'error');
            }
        }

        function showEditProductModal(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            // Fill form with current product data
            document.getElementById('editProductId').value = product.id;
            document.getElementById('editProductName').value = product.name;
            document.getElementById('editProductPrice').value = product.price;
            document.getElementById('editProductCost').value = product.cost || 0;
            document.getElementById('editProductDescription').value = product.description || '';
            
            // Show current image if exists
            const currentImagePreview = document.getElementById('currentImagePreview');
            const currentImg = document.getElementById('currentImg');
            if (product.image) {
                currentImg.src = product.image;
                currentImagePreview.classList.remove('hidden');
            } else {
                currentImagePreview.classList.add('hidden');
            }
            
            // Reset new image preview
            document.getElementById('editImagePreview').classList.add('hidden');
            document.getElementById('editProductImage').value = '';
            
            // Show modal
            document.getElementById('editProductModal').classList.remove('hidden');
            document.getElementById('editProductModal').classList.add('flex');
            
            // Add image preview functionality
            const imageInput = document.getElementById('editProductImage');
            const imagePreview = document.getElementById('editImagePreview');
            const previewImg = document.getElementById('editPreviewImg');
            
            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImg.src = e.target.result;
                        imagePreview.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    imagePreview.classList.add('hidden');
                }
            });
        }

        async function updateProduct() {
            const productId = document.getElementById('editProductId').value;
            const name = document.getElementById('editProductName').value;
            const price = parseFloat(document.getElementById('editProductPrice').value);
            const cost = parseFloat(document.getElementById('editProductCost').value);
            const description = document.getElementById('editProductDescription').value;
            const imageFile = document.getElementById('editProductImage').files[0];
            
            if (!name || !price || isNaN(cost)) {
                showNotification('üìù ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'warning');
                return;
            }
            
            if (cost >= price) {
                showNotification('üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Å‡∏≥‡πÑ‡∏£', 'warning');
                return;
            }
            
            try {
                const updates = {
                    name: name,
                    price: price,
                    cost: cost,
                    description: description
                };
                
                // Handle image upload if new image is selected
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        updates.image = e.target.result;
                        await updateProductInFirebase(productId, updates);
                        loadProducts();
                        loadProductsTable();
                        closeModal('editProductModal');
                        showNotification('‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß', 'success');
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    await updateProductInFirebase(productId, updates);
                    loadProducts();
                    loadProductsTable();
                    closeModal('editProductModal');
                    showNotification('‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            } catch (error) {
                console.error('Error updating product:', error);
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            }
        }

        async function deleteProduct(productId) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                try {
                    await deleteProductFromFirebase(productId);
                    loadProducts();
                    loadProductsTable();
                    alert('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                } catch (error) {
                    console.error('Error deleting product:', error);
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                }
            }
        }



        // Dashboard and reports
        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const currentMonth = new Date().toISOString().slice(0, 7); // YYYY-MM format
            
            const todaySales = sales.filter(sale => sale.date === today);
            const monthSales = sales.filter(sale => sale.date && sale.date.startsWith(currentMonth));
            
            const todayRevenue = todaySales.reduce((sum, sale) => sum + sale.total, 0);
            const todayProfit = Math.round(todayRevenue * 0.4); // 40% profit margin
            const todayCups = todaySales.reduce((sum, sale) => sum + sale.items.reduce((itemSum, item) => itemSum + item.quantity, 0), 0);
            const monthRevenue = monthSales.reduce((sum, sale) => sum + sale.total, 0);
            
            document.getElementById('todaySales').textContent = `‡∏ø${todayRevenue}`;
            document.getElementById('todayProfit').textContent = `‡∏ø${todayProfit}`;
            document.getElementById('todayCups').textContent = todayCups;
            document.getElementById('monthSales').textContent = `‡∏ø${monthRevenue}`;
            
            // Update dashboard top products
            loadDashboardTopProducts();
        }
        
        function loadDashboardTopProducts() {
            const topProducts = [...products]
                .sort((a, b) => b.sold - a.sold)
                .slice(0, 5);
            
            const dashboardTopProductsDiv = document.getElementById('dashboardTopProducts');
            dashboardTopProductsDiv.innerHTML = '';
            
            if (topProducts.length === 0 || topProducts.every(p => p.sold === 0)) {
                dashboardTopProductsDiv.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</p>';
                return;
            }
            
            topProducts.forEach((product, index) => {
                const item = document.createElement('div');
                item.className = 'flex justify-between items-center p-3 bg-gray-50 rounded-lg';
                item.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="text-lg font-bold text-green-600">#${index + 1}</span>
                        <span class="text-lg">${product.emoji}</span>
                        <div>
                            <p class="font-medium text-sm">${product.name}</p>
                            <p class="text-gray-600 text-xs">‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ ${product.sold} ‡πÅ‡∏Å‡πâ‡∏ß</p>
                        </div>
                    </div>
                    <span class="text-sm font-semibold text-green-600">‡∏ø${product.price * product.sold}</span>
                `;
                dashboardTopProductsDiv.appendChild(item);
            });
        }
        
        function loadRecentSales() {
            const recentSalesDiv = document.getElementById('recentSales');
            recentSalesDiv.innerHTML = '';
            
            // Get last 10 sales, sorted by timestamp (newest first)
            const recentSales = [...sales]
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 10);
            
            if (recentSales.length === 0) {
                recentSalesDiv.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</p>';
                return;
            }
            
            recentSales.forEach(sale => {
                const saleDiv = document.createElement('div');
                saleDiv.className = 'p-3 bg-gray-50 rounded-lg border';
                
                const saleTime = new Date(sale.timestamp).toLocaleString('th-TH', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Create detailed items list
                const itemsHTML = sale.items.map(item => {
                    let customizationText = '';
                    if (item.customization || (item.sweetness !== undefined || item.ice)) {
                        const sweetnessText = item.sweetness !== undefined ? `${item.sweetness}%` : '';
                        const iceText = item.ice === 'separate' ? '‡πÅ‡∏¢‡∏Å‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á' : item.ice === 'mixed' ? '‡πÉ‡∏™‡πà‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á' : '';
                        
                        if (sweetnessText || iceText) {
                            customizationText = `<span class="text-blue-600 text-xs ml-2">(${sweetnessText}${sweetnessText && iceText ? ', ' : ''}${iceText})</span>`;
                        }
                    }
                    
                    return `
                        <div class="flex justify-between items-center text-sm">
                            <span class="font-medium">${item.name} x${item.quantity}${customizationText}</span>
                            <span class="text-gray-600">‡∏ø${item.price * item.quantity}</span>
                        </div>
                    `;
                }).join('');
                
                saleDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex-1">
                            <p class="text-gray-600 text-xs mb-2">${saleTime}</p>
                            <div class="space-y-1">
                                ${itemsHTML}
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 ml-4">
                            <div class="text-right">
                                <span class="font-semibold text-green-600">‡∏ø${sale.total}</span>
                            </div>
                            <button onclick="deleteSale('${sale.id}')" class="text-red-500 hover:text-red-700 text-xs px-2 py-1 rounded bg-red-100 hover:bg-red-200 transition-colors">
                                ‡∏•‡∏ö
                            </button>
                        </div>
                    </div>
                `;
                
                recentSalesDiv.appendChild(saleDiv);
            });
        }
        
        async function deleteSale(saleId) {
            const sale = sales.find(s => s.id === saleId);
            if (!sale) return;
            
            showConfirmDialog(
                `üóëÔ∏è ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ ‡∏ø${sale.total.toLocaleString()} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
                async () => {
                    try {
                        // Restore product sold count
                        for (const item of sale.items) {
                            const product = products.find(p => p.id === item.id);
                            if (product) {
                                const newSoldCount = Math.max(0, product.sold - item.quantity);
                                await updateProductInFirebase(product.id, { sold: newSoldCount });
                            }
                        }
                        
                        // Delete sale from Firebase
                        await window.firestore.deleteDoc(window.firestore.doc(window.db, 'sales', saleId));
                        sales = sales.filter(s => s.id !== saleId);
                        
                        // Refresh displays
                        loadRecentSales();
                        updateDashboard();
                        
                        showNotification('üóëÔ∏è ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß', 'success');
                    } catch (error) {
                        console.error('Error deleting sale:', error);
                        showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢', 'error');
                    }
                }
            );
        }

        function createSalesChart() {
            const ctx = document.getElementById('salesChart').getContext('2d');
            
            // Get last 7 days data
            const last7Days = [];
            const salesData = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const dayName = date.toLocaleDateString('th-TH', { weekday: 'short' });
                
                last7Days.push(dayName);
                
                const daySales = sales.filter(sale => sale.date === dateStr);
                const dayRevenue = daySales.reduce((sum, sale) => sum + sale.total, 0);
                salesData.push(dayRevenue);
            }
            
            if (salesChart) {
                salesChart.destroy();
            }
            
            salesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)',
                        data: salesData,
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function loadReports() {
            // Calculate real financial data
            const totalRevenue = sales.reduce((sum, sale) => sum + sale.total, 0);
            
            // Calculate total cost based on actual product costs
            let totalCost = 0;
            let totalCups = 0;
            
            sales.forEach(sale => {
                sale.items.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (product && product.cost) {
                        totalCost += product.cost * item.quantity;
                    }
                    totalCups += item.quantity;
                });
            });
            
            const netProfit = totalRevenue - totalCost;
            const profitMargin = totalRevenue > 0 ? ((netProfit / totalRevenue) * 100).toFixed(1) : 0;
            
            // Update summary cards
            document.getElementById('totalRevenue').textContent = `‡∏ø${totalRevenue}`;
            document.getElementById('netProfit').textContent = `‡∏ø${Math.round(netProfit)}`;
            document.getElementById('totalCups').textContent = totalCups;
            document.getElementById('profitMargin').textContent = `${profitMargin}%`;
            
            // Product report
            const productReportDiv = document.getElementById('productReport');
            productReportDiv.innerHTML = '';
            
            // Sort products by revenue (price * sold)
            const productsByRevenue = [...products]
                .map(product => ({
                    ...product,
                    revenue: product.price * product.sold,
                    profit: (product.price - (product.cost || 0)) * product.sold
                }))
                .sort((a, b) => b.revenue - a.revenue);
            
            if (productsByRevenue.length === 0 || productsByRevenue.every(p => p.sold === 0)) {
                productReportDiv.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</p>';
                return;
            }
            
            productsByRevenue.forEach((product, index) => {
                if (product.sold > 0) {
                    const item = document.createElement('div');
                    item.className = 'flex justify-between items-center p-4 bg-gray-50 rounded-lg';
                    item.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <span class="text-lg font-bold text-green-600">#${index + 1}</span>
                            <span class="text-lg">${product.emoji}</span>
                            <div>
                                <p class="font-medium">${product.name}</p>
                                <p class="text-gray-600 text-sm">‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ ${product.sold} ‡πÅ‡∏Å‡πâ‡∏ß</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-green-600">‡∏ø${product.revenue}</p>
                            <p class="text-sm text-blue-600">‡∏Å‡∏≥‡πÑ‡∏£ ‡∏ø${Math.round(product.profit)}</p>
                        </div>
                    `;
                    productReportDiv.appendChild(item);
                }
            });
        }

        // Modal functions
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        }

        // Loading indicator functions
        function showLoading() {
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loadingIndicator';
            loadingDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            loadingDiv.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-xl text-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto mb-4"></div>
                    <p class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                </div>
            `;
            document.body.appendChild(loadingDiv);
        }

        function hideLoading() {
            const loadingDiv = document.getElementById('loadingIndicator');
            if (loadingDiv) {
                loadingDiv.remove();
            }
        }

        // Review functions
        function setRating(rating) {
            currentRating = rating;
            
            // Update star display with enhanced visual feedback
            const stars = document.querySelectorAll('.star-btn');
            stars.forEach((star, index) => {
                if (index < rating) {
                    // Selected stars - bright yellow with glow effect
                    star.classList.remove('text-gray-300', 'scale-100');
                    star.classList.add('text-yellow-400', 'scale-110', 'drop-shadow-lg');
                    star.style.textShadow = '0 0 10px rgba(251, 191, 36, 0.8)';
                } else {
                    // Unselected stars - gray
                    star.classList.remove('text-yellow-400', 'scale-110', 'drop-shadow-lg');
                    star.classList.add('text-gray-300', 'scale-100');
                    star.style.textShadow = 'none';
                }
            });
            
            // Update rating text with color coding
            const ratingTexts = ['', '‡πÅ‡∏¢‡πà‡∏°‡∏≤‡∏Å', '‡πÅ‡∏¢‡πà', '‡∏õ‡∏Å‡∏ï‡∏¥', '‡∏î‡∏µ', '‡∏î‡∏µ‡∏°‡∏≤‡∏Å'];
            const ratingColors = ['', 'text-red-600', 'text-orange-600', 'text-yellow-600', 'text-green-600', 'text-green-700'];
            const ratingTextElement = document.getElementById('ratingText');
            
            if (ratingTextElement) {
                ratingTextElement.textContent = `${ratingTexts[rating]} (${rating} ‡∏î‡∏≤‡∏ß)`;
                ratingTextElement.className = `text-center text-sm font-medium mt-2 min-h-[20px] ${ratingColors[rating]}`;
            }
        }

        async function submitReview() {
            const reviewerName = document.getElementById('reviewerName').value.trim();
            const reviewText = document.getElementById('reviewText').value.trim();
            
            if (!reviewerName) {
                showNotification('üë§ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏¥‡∏£‡∏ô‡∏≤‡∏° ‡πÄ‡∏ä‡πà‡∏ô "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 1"', 'warning');
                return;
            }
            
            if (currentRating === 0) {
                showNotification('‚≠ê ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß', 'warning');
                return;
            }
            
            if (!reviewText) {
                showNotification('‚úçÔ∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì', 'warning');
                return;
            }
            
            try {
                const review = {
                    reviewerName: reviewerName,
                    rating: currentRating,
                    reviewText: reviewText,
                    date: new Date().toISOString().split('T')[0],
                    time: new Date().toLocaleTimeString('th-TH'),
                    timestamp: new Date().toISOString()
                };
                
                await saveReviewToFirebase(review);
                
                // Clear form
                document.getElementById('reviewerName').value = '';
                document.getElementById('reviewText').value = '';
                setRating(0);
                
                // Reload reviews
                loadRecentReviews();
                
                showNotification(`üí¨ ‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß ${currentRating} ‡∏î‡∏≤‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô`, 'success');
            } catch (error) {
                console.error('Error submitting review:', error);
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            }
        }

        function loadRecentReviews() {
            const recentReviewsDiv = document.getElementById('recentReviews');
            if (!recentReviewsDiv) return;
            
            recentReviewsDiv.innerHTML = '';
            
            // Get last 10 reviews, sorted by timestamp (newest first)
            const recentReviews = [...reviews]
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 10);
            
            if (recentReviews.length === 0) {
                recentReviewsDiv.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</p>';
                return;
            }
            
            recentReviews.forEach(review => {
                const reviewDiv = document.createElement('div');
                reviewDiv.className = 'p-4 bg-gray-50 rounded-lg border';
                
                const reviewTime = new Date(review.timestamp).toLocaleString('th-TH', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Create star display
                const stars = Array.from({length: 5}, (_, i) => 
                    i < review.rating ? '‚≠ê' : '‚òÜ'
                ).join('');
                
                let replyHTML = '';
                if (review.adminReply) {
                    const replyTime = new Date(review.adminReplyTimestamp).toLocaleString('th-TH', {
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    replyHTML = `
                        <div class="mt-3 p-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="text-green-700 font-medium text-sm">üçµ LUV U SO MATCHA</span>
                                <span class="text-green-600 text-xs">${replyTime}</span>
                            </div>
                            <p class="text-green-800 text-sm">${review.adminReply}</p>
                        </div>
                    `;
                }
                
                reviewDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="font-medium text-sm">${review.reviewerName}</span>
                                <span class="text-yellow-400 text-sm">${stars}</span>
                            </div>
                            <p class="text-gray-700 text-sm mb-2">${review.reviewText}</p>
                            <p class="text-gray-500 text-xs">${reviewTime}</p>
                            ${replyHTML}
                        </div>
                    </div>
                `;
                
                recentReviewsDiv.appendChild(reviewDiv);
            });
        }

        function loadAdminReviews() {
            updateReviewsStats();
            
            const adminReviewsList = document.getElementById('adminReviewsList');
            adminReviewsList.innerHTML = '';
            
            // Sort reviews by timestamp (newest first)
            const sortedReviews = [...reviews]
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            if (sortedReviews.length === 0) {
                adminReviewsList.innerHTML = '<p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</p>';
                return;
            }
            
            sortedReviews.forEach(review => {
                const reviewDiv = document.createElement('div');
                reviewDiv.className = 'p-4 bg-gray-50 rounded-lg border';
                
                const reviewTime = new Date(review.timestamp).toLocaleString('th-TH', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Create star display
                const stars = Array.from({length: 5}, (_, i) => 
                    i < review.rating ? '‚≠ê' : '‚òÜ'
                ).join('');
                
                // Rating color based on score
                const ratingColors = {
                    1: 'text-red-600',
                    2: 'text-orange-600', 
                    3: 'text-yellow-600',
                    4: 'text-green-600',
                    5: 'text-green-700'
                };
                
                let replyHTML = '';
                let actionButtonHTML = '';
                
                if (review.adminReply) {
                    const replyTime = new Date(review.adminReplyTimestamp).toLocaleString('th-TH', {
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    replyHTML = `
                        <div class="mt-3 p-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center space-x-2">
                                    <span class="text-green-700 font-medium text-sm">üçµ LUV U SO MATCHA</span>
                                    <span class="text-green-600 text-xs">${replyTime}</span>
                                </div>
                                <button onclick="editReply('${review.id}')" class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 rounded bg-blue-100 hover:bg-blue-200 transition-colors">
                                    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                </button>
                            </div>
                            <p class="text-green-800 text-sm">${review.adminReply}</p>
                        </div>
                    `;
                } else {
                    actionButtonHTML = `
                        <button onclick="showReplyModal('${review.id}')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm transition-colors">
                            ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
                        </button>
                    `;
                }
                
                reviewDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center space-x-3">
                                    <span class="font-medium text-lg">${review.reviewerName}</span>
                                    <span class="text-yellow-400 text-lg">${stars}</span>
                                    <span class="text-sm font-medium ${ratingColors[review.rating] || 'text-gray-600'}">(${review.rating}/5)</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-gray-500 text-sm">${reviewTime}</span>
                                    ${actionButtonHTML}
                                </div>
                            </div>
                            <p class="text-gray-800 mb-2 leading-relaxed">${review.reviewText}</p>
                            ${replyHTML}
                        </div>
                    </div>
                `;
                
                adminReviewsList.appendChild(reviewDiv);
            });
        }

        function updateReviewsStats() {
            const today = new Date().toISOString().split('T')[0];
            
            // Total reviews
            document.getElementById('totalReviews').textContent = reviews.length;
            
            // Average rating
            if (reviews.length > 0) {
                const avgRating = reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length;
                document.getElementById('averageRating').textContent = avgRating.toFixed(1);
            } else {
                document.getElementById('averageRating').textContent = '0.0';
            }
            
            // Today's reviews
            const todayReviews = reviews.filter(review => review.date === today).length;
            document.getElementById('todayReviews').textContent = todayReviews;
            
            // Pending replies
            const pendingReplies = reviews.filter(review => !review.adminReply).length;
            document.getElementById('pendingReplies').textContent = pendingReplies;
        }

        function showReplyModal(reviewId) {
            const review = reviews.find(r => r.id === reviewId);
            if (!review) return;
            
            // Fill original review info
            const originalReviewDiv = document.getElementById('originalReview');
            const stars = Array.from({length: 5}, (_, i) => 
                i < review.rating ? '‚≠ê' : '‚òÜ'
            ).join('');
            
            originalReviewDiv.innerHTML = `
                <div class="flex items-center space-x-2 mb-2">
                    <span class="font-medium">${review.reviewerName}</span>
                    <span class="text-yellow-400">${stars}</span>
                </div>
                <p class="text-gray-700">${review.reviewText}</p>
                <p class="text-gray-500 text-sm mt-2">${new Date(review.timestamp).toLocaleString('th-TH')}</p>
            `;
            
            // Set review ID and clear reply text
            document.getElementById('replyReviewId').value = reviewId;
            document.getElementById('adminReplyText').value = review.adminReply || '';
            
            // Show modal
            document.getElementById('replyReviewModal').classList.remove('hidden');
            document.getElementById('replyReviewModal').classList.add('flex');
        }

        function editReply(reviewId) {
            showReplyModal(reviewId);
        }

        async function submitReply() {
            const reviewId = document.getElementById('replyReviewId').value;
            const replyText = document.getElementById('adminReplyText').value.trim();
            
            if (!replyText) {
                showNotification('‚úçÔ∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 'warning');
                return;
            }
            
            try {
                const updates = {
                    adminReply: replyText,
                    adminReplyTimestamp: new Date().toISOString()
                };
                
                await updateReviewInFirebase(reviewId, updates);
                
                // Refresh displays
                loadAdminReviews();
                loadRecentReviews();
                
                closeModal('replyReviewModal');
                showNotification('üí¨ ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì', 'success');
            } catch (error) {
                console.error('Error submitting reply:', error);
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            }
        }

        // Finance Management Functions
        function loadFinanceSection() {
            updateFinanceSummary();
            loadFinanceTable();
            createFinanceCharts();
        }

        function updateFinanceSummary() {
            const totalIncome = financeRecords
                .filter(record => record.type === 'income')
                .reduce((sum, record) => sum + record.amount, 0);
            
            const totalExpense = financeRecords
                .filter(record => record.type === 'expense')
                .reduce((sum, record) => sum + record.amount, 0);
            
            const netBalance = totalIncome - totalExpense;
            
            document.getElementById('totalIncome').textContent = `‡∏ø${totalIncome.toLocaleString()}`;
            document.getElementById('totalExpense').textContent = `‡∏ø${totalExpense.toLocaleString()}`;
            document.getElementById('netBalance').textContent = `‡∏ø${netBalance.toLocaleString()}`;
            
            // Update color based on balance
            const netBalanceElement = document.getElementById('netBalance');
            if (netBalance >= 0) {
                netBalanceElement.className = 'text-2xl font-bold text-green-600';
            } else {
                netBalanceElement.className = 'text-2xl font-bold text-red-600';
            }
        }

        function loadFinanceTable() {
            const tbody = document.getElementById('financeTable');
            tbody.innerHTML = '';
            
            // Sort by date (newest first)
            const sortedRecords = [...financeRecords].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (sortedRecords.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
                        </td>
                    </tr>
                `;
                return;
            }
            
            sortedRecords.forEach(record => {
                const row = document.createElement('tr');
                const formattedDate = new Date(record.date).toLocaleDateString('th-TH');
                const typeText = record.type === 'income' ? '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö' : '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢';
                const typeColor = record.type === 'income' ? 'text-green-600' : 'text-red-600';
                const amountColor = record.type === 'income' ? 'text-green-600' : 'text-red-600';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${formattedDate}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${record.type === 'income' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${typeText}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900 max-w-xs">
                        <p class="truncate">${record.item}</p>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold ${amountColor}">
                        ${record.type === 'income' ? '+' : '-'}‡∏ø${record.amount.toLocaleString()}
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900 max-w-xs">
                        <p class="truncate">${record.note || '-'}</p>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                        <button onclick="showEditFinanceModal('${record.id}')" class="text-blue-600 hover:text-blue-900">
                            ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                        <button onclick="deleteFinanceRecord('${record.id}')" class="text-red-600 hover:text-red-900">
                            ‡∏•‡∏ö
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function createFinanceCharts() {
            createMonthlyFinanceChart();
            createExpenseBreakdownChart();
        }

        function createMonthlyFinanceChart() {
            const ctx = document.getElementById('financeChart').getContext('2d');
            
            // Get last 6 months data
            const months = [];
            const incomeData = [];
            const expenseData = [];
            
            for (let i = 5; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                const monthStr = date.toISOString().slice(0, 7); // YYYY-MM
                const monthName = date.toLocaleDateString('th-TH', { month: 'short', year: 'numeric' });
                
                months.push(monthName);
                
                const monthIncome = financeRecords
                    .filter(record => record.date.startsWith(monthStr) && record.type === 'income')
                    .reduce((sum, record) => sum + record.amount, 0);
                
                const monthExpense = financeRecords
                    .filter(record => record.date.startsWith(monthStr) && record.type === 'expense')
                    .reduce((sum, record) => sum + record.amount, 0);
                
                incomeData.push(monthIncome);
                expenseData.push(monthExpense);
            }
            
            if (financeChart) {
                financeChart.destroy();
            }
            
            financeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö',
                            data: incomeData,
                            backgroundColor: 'rgba(34, 197, 94, 0.8)',
                            borderColor: 'rgba(34, 197, 94, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢',
                            data: expenseData,
                            backgroundColor: 'rgba(239, 68, 68, 0.8)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createExpenseBreakdownChart() {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            
            // Group expenses by category (item name)
            const expenseCategories = {};
            financeRecords
                .filter(record => record.type === 'expense')
                .forEach(record => {
                    if (expenseCategories[record.item]) {
                        expenseCategories[record.item] += record.amount;
                    } else {
                        expenseCategories[record.item] = record.amount;
                    }
                });
            
            const labels = Object.keys(expenseCategories);
            const data = Object.values(expenseCategories);
            
            if (expenseChart) {
                expenseChart.destroy();
            }
            
            if (labels.length === 0) {
                // Show empty state
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'flex items-center justify-center h-full text-gray-500';
                emptyDiv.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢';
                document.getElementById('expenseChart').parentNode.appendChild(emptyDiv);
                return;
            }
            
            // Generate colors for each category
            const colors = [
                '#ef4444', '#f97316', '#eab308', '#22c55e', '#06b6d4',
                '#3b82f6', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981'
            ];
            
            expenseChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function showAddFinanceModal() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('financeDate').value = today;
            
            // Clear form
            document.getElementById('financeType').value = '';
            document.getElementById('financeItem').value = '';
            document.getElementById('financeAmount').value = '';
            document.getElementById('financeNote').value = '';
            
            // Show modal
            document.getElementById('addFinanceModal').classList.remove('hidden');
            document.getElementById('addFinanceModal').classList.add('flex');
        }

        async function addFinanceRecord() {
            const date = document.getElementById('financeDate').value;
            const type = document.getElementById('financeType').value;
            const item = document.getElementById('financeItem').value.trim();
            const amount = parseFloat(document.getElementById('financeAmount').value);
            const note = document.getElementById('financeNote').value.trim();
            
            if (!date || !type || !item || !amount || amount <= 0) {
                showNotification('üìù ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó, ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô)', 'warning');
                return;
            }
            
            try {
                const record = {
                    date: date,
                    type: type,
                    item: item,
                    amount: amount,
                    note: note,
                    timestamp: new Date().toISOString()
                };
                
                await saveFinanceRecordToFirebase(record);
                
                loadFinanceSection();
                closeModal('addFinanceModal');
                
                const typeText = type === 'income' ? '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö' : '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢';
                const emoji = type === 'income' ? 'üí∞' : 'üí∏';
                showNotification(`${emoji} ‡πÄ‡∏û‡∏¥‡πà‡∏°${typeText} "${item}" ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏ø${amount.toLocaleString()} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
            } catch (error) {
                console.error('Error adding finance record:', error);
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            }
        }

        function showEditFinanceModal(recordId) {
            const record = financeRecords.find(r => r.id === recordId);
            if (!record) return;
            
            // Fill form with current data
            document.getElementById('editFinanceId').value = record.id;
            document.getElementById('editFinanceDate').value = record.date;
            document.getElementById('editFinanceType').value = record.type;
            document.getElementById('editFinanceItem').value = record.item;
            document.getElementById('editFinanceAmount').value = record.amount;
            document.getElementById('editFinanceNote').value = record.note || '';
            
            // Show modal
            document.getElementById('editFinanceModal').classList.remove('hidden');
            document.getElementById('editFinanceModal').classList.add('flex');
        }

        async function updateFinanceRecord() {
            const recordId = document.getElementById('editFinanceId').value;
            const date = document.getElementById('editFinanceDate').value;
            const type = document.getElementById('editFinanceType').value;
            const item = document.getElementById('editFinanceItem').value.trim();
            const amount = parseFloat(document.getElementById('editFinanceAmount').value);
            const note = document.getElementById('editFinanceNote').value.trim();
            
            if (!date || !type || !item || !amount || amount <= 0) {
                showNotification('üìù ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'warning');
                return;
            }
            
            try {
                const updates = {
                    date: date,
                    type: type,
                    item: item,
                    amount: amount,
                    note: note
                };
                
                await updateFinanceRecordInFirebase(recordId, updates);
                
                loadFinanceSection();
                closeModal('editFinanceModal');
                
                const typeText = type === 'income' ? '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö' : '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢';
                const emoji = type === 'income' ? 'üí∞' : 'üí∏';
                showNotification(`${emoji} ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï${typeText} "${item}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß`, 'success');
            } catch (error) {
                console.error('Error updating finance record:', error);
                showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            }
        }

        async function deleteFinanceRecord(recordId) {
            const record = financeRecords.find(r => r.id === recordId);
            if (!record) return;
            
            const typeText = record.type === 'income' ? '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö' : '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢';
            
            showConfirmDialog(
                `üóëÔ∏è ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö${typeText} "${record.item}" ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏ø${record.amount.toLocaleString()} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
                async () => {
                    try {
                        await deleteFinanceRecordFromFirebase(recordId);
                        loadFinanceSection();
                        showNotification(`üóëÔ∏è ‡∏•‡∏ö${typeText}‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß`, 'success');
                    } catch (error) {
                        console.error('Error deleting finance record:', error);
                        showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
                    }
                }
            );
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('POS System initialized');
            
            // Auto login as customer when page loads
            currentUser = '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤';
            isAdmin = false;
            showMainApp();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9775b61617295805',t:'MTc1NjU3MTgzMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
